{% extends ':Front:layout.html.twig' %}

{% block title %}{{ parent() }} Â· {{ user.username }}{% endblock %}

{% block bodyattr %}class="profile"{% endblock %}

{% block main %}
<div class="container">
    {#<!-- Back portrait panel -->#}
    <div class="row">
        <div class="col-md-12">
            <div class="banner">
                <div class="overlap">
                    <img class="img-responsive center-block" data-src="holder.js/1140x153/#7EA0B6:#7EA0B6" alt="dummy"/>
                </div>
            </div>
        </div>
    </div>
    {# Photo & Username #}
    <div class="row">
        <div class="col-md-3">
            <img class="img-responsive" src="{{ user | image | imagine_filter('300x300') }}" alt="{{ user.username }} GO Premia user profile"/>
        </div>
        <div class="col-md-9">
            <h2>{{ user.username }}<small class="pull-right">{{ 'front.profile.lastaccess' | trans }} {{ user.lastLogin | localizeddate('medium', 'none') }}</small></h2>
        </div>
    </div>
    {# Edit profile button & About me #}
    <div class="row">
        <div class="col-md-3">
            {% if app.user == user %}
                <a class="btn btn-primary" href="{{ path('fos_user_profile_edit', {'username': user.username}) }}"><i class="fa fa-pencil"></i> {{ 'front.profile.edit'|trans }}</a>
            {% endif %}
        </div>
        <div class="col-md-9">
            <p class="lead">{{ user.description }}</p>
        </div>
    </div>
    {# Map & Lists #}
    <div class="row">
        <div class="col-md-3">
            <h3><span class="icon-map_placeholder"></span> {{ 'front.profile.map' }}</h3>
            {% if user.gps %}
                <div id="map"></div>
            {% endif %}
        </div>
        <div class="col-md-9">
            <div role="tabpanel">
                {#<!-- Tab menu -->#}
                <ul class="nav nav-pills nav-justified" role="tablist">
                    <li role="presentation" class="active"><a href="#proposals" aria-controls="proposals" role="tab" data-toggle="tab">{{ 'front.profile.proposals' | trans }}</a></li>
                    <li role="presentation"><a href="#comments" aria-controls="comments" role="tab" data-toggle="tab">{{ 'front.profile.comments' | trans }}</a></li>
                </ul>
                {#<!-- Tab panels -->#}
                <div class="tab-content">
                    <div role="tabpanel" class="tab-pane active" id="proposals">
                        o
                        {#{% include 'Front/includes/participation/discussions-list.html.twig' with { 'discussions': openDiscussions } %}#}
                    </div>
                    <div role="tabpanel" class="tab-pane" id="comments">
                        <ul class="media-list no-m-bottom" style="margin-top:20px">
                            {% for comment in user.comments %}
                                <li class="media">
                                    <div class="media-left">
                                        a
                                    </div>
                                    <div class="media-body">
                                        <h4 class="media-heading">{{ comment.title }}</h4>
                                        {#<h6>{{ comment.createdAt }}</h6>#}
                                        <p>{{ comment.comment }}</p>
                                    </div>
                                </li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
                {#<div class="col-md-12">#}
                    {#<div class="well">#}
                        {#<h3 class="no-m-top">{% trans %}{% endtrans %}</h3>#}
                        {#<ul>#}
                            {#{% for proposal in proposals %}#}
                                {#<li> {{ proposal.title }}#}
                                    {#{% if proposal.isAuthor(app.user) %}#}
                                        {#<a href="{{ path('demofony2_front_participation_proposals_edit', {'id': proposal.id}) }}">{{ 'edit'|trans }}</a>#}
                                    {#{% endif %}#}
                                {#</li>#}
                            {#{% endfor %}#}
                        {#</ul>#}
                        {#{{ knp_pagination_render(proposals) }}#}

                        {#&#123;&#35; TODO include user proposals &#35;&#125;#}
                        {#&#123;&#35;{% include 'Front/includes/participation/proposals.open.html.twig' %}&#35;&#125;#}
                        {#&#123;&#35;<h3></h3>&#35;&#125;#}
                        {#&#123;&#35;{% include ':Front/includes:pagination.html.twig' %}&#35;&#125;#}
                    {#</div>#}
                {#</div>#}
                {#<div class="col-md-12">#}
                    {#<div class="well">#}
                        {#<h3 class="no-m-top">{% trans %}front.profile.comments{% endtrans %}</h3>#}

                        {#<div class="form-group no-m-bottom">#}
                            {#<ul class="media-list no-m-bottom extra-m-top">#}
                                {#&#123;&#35;{% for comment in user.comments %} &#123;&#35; TODO replace user.comments with comments &#35;&#125;&#35;&#125;#}
                                    {#&#123;&#35;<li class="media extra-m-top">&#35;&#125;#}
                                        {#&#123;&#35;<div class="media-body">&#35;&#125;#}
                                            {#&#123;&#35;<h4 class="media-heading">{{ comment.title }}<span&#35;&#125;#}
                                                        {#&#123;&#35;class="label label-default pull-right">{{ comment.createdAt | localizeddate('medium', 'none') }}</span>&#35;&#125;#}
                                            {#&#123;&#35;</h4>&#35;&#125;#}
                                            {#&#123;&#35;{{ comment.comment }}&#35;&#125;#}
                                        {#&#123;&#35;</div>&#35;&#125;#}
                                        {#&#123;&#35;<a class="media-right"&#35;&#125;#}
                                           {#&#123;&#35;href="&#123;&#35;{{ path('front_participation_proposals_show', {id: comment.proposal.id, proposal: comment.proposal.titleSlug}) }}&#35;&#125;"> &#123;&#35; TODO set proposal link &#35;&#125;&#35;&#125;#}
                                            {#&#123;&#35;<button type="button" class="btn btn-sm btn-default"><i&#35;&#125;#}
                                                        {#&#123;&#35;class="fa fa-comments"></i> {% trans %}&#35;&#125;#}
                                                {#&#123;&#35;front.profile.showproposal{% endtrans %}</button>&#35;&#125;#}
                                        {#&#123;&#35;</a>&#35;&#125;#}
                                    {#&#123;&#35;</li>&#35;&#125;#}
                                {#&#123;&#35;{% endfor %}&#35;&#125;#}
                            {#</ul>#}
                        {#</div>#}
                    {#</div>#}
                {#</div>#}
            {#</div>#}

        {#</div>#}
    {#</div>#}
{% endblock %}

{% block body_javascripts %}
    <script type="text/javascript">
        function initializeGooleMaps() {
            console.log('initializeGooleMaps');
            var mapOptions = {
                zoom: 14,
                center: new google.maps.LatLng({{ user.gps.lat }}, {{ user.gps.lng }})
            };
            var map = new google.maps.Map(document.getElementById('map'), mapOptions);
            var point = { position: new google.maps.LatLng({{ user.gps.lat }}, {{ user.gps.lng }}) };
            point.marker = new google.maps.Marker({
                position: point.position,
                map: map,
                animation: google.maps.Animation.DROP,
                bounds: true
            });
        }
        function loadGoogleMapsScript() {
            console.log('loadGoogleMapsScript');
            var script = document.createElement('script');
            script.type = 'text/javascript';
            script.src = '//maps.google.com/maps/api/js?sensor=false&v=3.8&language={{ app.request.locale }}&callback=initializeGooleMaps';
            document.body.appendChild(script);
        }
        jQuery(document).ready(function() {
            console.log('ready');
            loadGoogleMapsScript();
        });
    </script>
{% endblock %}

{% block footlangca %}{{ path('fos_user_profile_public_show', {'_locale': 'ca', username: user.username}) }}{% endblock %}
{% block footlanges %}{{ path('fos_user_profile_public_show', {'_locale': 'es', username: user.username}) }}{% endblock %}
{% block footlangen %}{{ path('fos_user_profile_public_show', {'_locale': 'en', username: user.username}) }}{% endblock %}
