"use strict";angular.module("discussionShowApp",["discussionShowApp.services","ngCookies","ngResource","ngSanitize","ngRoute","uiGmapgoogle-maps","restangular"]).config(["$interpolateProvider",function(o){o.startSymbol("[["),o.endSymbol("]]")}]).config(function(o){o.configure({v:"3.17",language:"es",sensor:!1,libraries:"drawing,geometry,visualization"})}).constant("CFG",{DELAY:600,RANGE_STEPS:20,GMAPS_ZOOM:14,GPS_CENTER_POS:{lat:41.4926867,lng:2.3613954},PROCESS_PARTICIPATION_STATE:{DRAFT:1,PRESENTATION:2,DEBATE:3,CLOSED:4}}),angular.module("discussionShowApp").controller("MainCtrl",["CFG","uiGmapGoogleMapApi","$scope","$timeout","$routeParams","$log","Restangular","$q","Security","$http",function(o,n,t,e,i,s,c,a,u,r){t.init=function(n,e,i,c){t.discussion=angular.fromJson(n),t.comments=angular.fromJson(e),t.is_logged=i,t.username=c,t.canVotePromise=u.canVoteInProcessParticipation(t.discussion.state,t.is_logged),t.map={zoom:o.GMAPS_ZOOM},t.map.options={scrollwheel:!0,draggable:!0,maxZoom:15},t.map.control={},t.currentPage=1,t.comment.update(),s.log(t.discussion),s.log(t.comments),s.log(t.comments.count),s.log(t.pages)},t.vote=function(o){t.canVotePromise.then(function(){var n=Routing.generate("api_post_processparticipation_answers_vote",{id:t.discussion.id,answer_id:o.id}),e=c.all(n.substring(1));if(!o.user_has_vote_this_proposal_answer){var i={comment:null};return void e.post(i).then(function(){o.votes_count++,o.user_has_vote_this_proposal_answer=!0,t.discussion.user_already_vote=!0,t.discussion.total_votes_count++})}e.remove().then(function(){o.votes_count--,o.user_has_vote_this_proposal_answer=!1,t.discussion.user_already_vote=!1,t.discussion.total_votes_count--})},function(){t.showModal.login()})},t.comment={like:function(o,n){t.canVotePromise.then(function(){var e=Routing.generate("api_post_processparticipation_comments_like",{id:t.discussion.id,comment_id:o.id}),i=c.all(e.substring(1));return o.user_already_like?void i.remove().then(function(o){t.comments.comments[n]=o}):void i.post().then(function(o){t.comments.comments[n]=o})},function(){t.showModal.login()})},unlike:function(o,n){t.canVotePromise.then(function(){var e=Routing.generate("api_post_processparticipation_comments_unlike",{id:t.discussion.id,comment_id:o.id}),i=c.all(e.substring(1));return o.user_already_unlike?void i.remove().then(function(o){t.comments.comments[n]=o}):void i.post().then(function(o){t.comments.comments[n]=o})},function(){t.showModal.login()})},post:function(o){t.canVotePromise.then(function(){var n=Routing.generate("api_post_processparticipation_comments",{id:t.discussion.id}),e=c.all(n.substring(1));e.post(o).then(function(o){o.likes_count=0,o.unlikes_count=0,t.comments.comments.unshift(o)})},function(){t.showModal.login()})},put:function(o){s.log("comment put log"),t.canVotePromise.then(function(){var n=Routing.generate("api_put_processparticipation_comments",{id:t.discussion.id,comment_id:o.id}),e=c.all(n.substring(1)),i={title:o.title,comment:o.comment};e.customPUT(i).then(function(){jQuery("#edit-comment-"+o.id).addClass("hide")})},function(){t.showModal.login()})},showEditForm:function(o){jQuery("#edit-comment-"+o).removeClass("hide")},getListLevel1:function(o){r.get(Routing.generate("api_get_processparticipation_comments",{id:t.discussion.id,page:o},!1)).success(function(n){t.comments=n,t.comment.update(),t.currentPage=o})},getAnswers:function(o){r.get(Routing.generate("api_get_processparticipation_comments_childrens",{id:t.discussion.id,comment_id:o.id},!1)).success(function(n){o.answers=n})},update:function(){t.pages=Math.ceil(t.comments.count/10)}},t.showModal={login:function(){t.is_logged||jQuery("#login-modal-form").modal({show:!0})}},t.range=function(o){return new Array(o)},t.getComments=function(){},n.then(function(o){s.log("uiGmapGoogleMapApi loaded",o)})}]);var services=angular.module("discussionShowApp.services",[]);services.factory("Security",function(o,n,t){return{canVoteInProcessParticipation:function(n,e){return o(function(o,i){e?n===t.PROCESS_PARTICIPATION_STATE.DEBATE&&e&&o():i()})}}});